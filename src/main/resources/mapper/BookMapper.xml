<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gs.reusebook.dao.BookDao">

	<select id="selectById" resultType="Book" resultMap="normalBookResultMap">
		SELECT
		  b.id,
		  b.`name`,
		  b.`author`,
		  b.`isbn`,
		  t.`id` book_type_id,
		  t.`name` book_type_name
		FROM
		  `tab_book` b,
		  `tab_book_type_rel` r,
		  `tab_book_type` t 
		WHERE b.id = #{id} 
		  AND b.id = r.book_id 
		  AND r.`book_type_id` = t.`id`
	</select>
	
	<select id="selectByBookCondition" resultType="Book" resultMap="normalBookResultMap">
		SELECT
		  b.id,
		  b.`name`,
		  b.`author`,
		  b.`isbn`,
		  t.`id` book_type_id,
		  t.`name` book_type_name 
		FROM
		  `tab_book` b,
		  `tab_book_type_rel` r,
		  `tab_book_type` t 
		WHERE b.id = r.book_id 
		  AND r.`book_type_id` = t.`id` 
		  AND r.book_type_id IN
		<foreach item="item" index="index" collection="types" open="(" separator="," close=")">
			#{item}
        </foreach>
	</select>

	<resultMap type="com.gs.reusebook.bean.Book" id="normalBookResultMap">
		<id property="id" column="id" />
		<result property="name" column="name" />
		<result property="author" column="author" />
		<result property="isbn" column="isbn" />
		<collection property="types" ofType="com.gs.reusebook.bean.BookType">
			<id property="id" column="book_type_id" />
			<result property="name" column="book_type_name" />
		</collection>
	</resultMap>

</mapper>